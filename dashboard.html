const functions = require("firebase-functions");
const nodemailer = require("nodemailer");

const transporter = nodemailer.createTransport({
  service: "gmail",
  auth: {
    user: "your-email@gmail.com",
    pass: "your-app-password"
  }
});

exports.sendEmail = functions.firestore
  .document("workshops/{workshopId}")
  .onUpdate((change, context) => {
    const after = change.after.data();
    if (after.reserved && after.reservedBy?.email) {
      const mailOptions = {
        from: "your-email@gmail.com",
        to: after.reservedBy.email,
        subject: "تأكيد الحجز",
        text: `مرحباً ${after.reservedBy.name}, تم تأكيد حجزك في ورشة ${after.title}`
      };
      return transporter.sendMail(mailOptions);
    }
    return null;
  });
